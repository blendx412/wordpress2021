jQuery(document).ready(function(){var t=jQuery(".wcbv-wrapper"),a=jQuery(".variations_form"),v=a.find(".variations select"),i=jQuery('[name="_wcbv_variations"]:first').parents("form:first"),s=null,n=!0,e=function(c){s=null,a.find("select").val("").change();//reset wc selects to get all options
var e,r=t.children(".wcbv-variations").append('<div class="wcbv-row wcbv-clearfix"><div class="wcbv-fields wcbv-clearfix"><div class="wcbv-selects wcbv-columns wcbv-two"></div></div><div class="wcbv-price"></div></div>').children(".wcbv-row:last").children(".wcbv-fields");
//loop through
v.each(function(e,t){var i=jQuery(t),a=c&&c.hasOwnProperty(t.name)?c[t.name]:"",n=jQuery('<div><select data-attribute="'+t.name+'" value="'+a+'"></select></div>');n.children("select").html(i.html()).val(a),r.children(".wcbv-selects").append(n)}),r.append('<div class="wcbv-quantity"><input type="number" value=1 min=0 step=1></div><div class="wcbv-remove"><span class="wcbv-remove-row">x</span></div>'),jQuery().select2&&wcbvOptions.enableSelect&&r.find("select").select2({dropdownCssClass:"wcbv-select2",width:"100%"}),r.find("select:last").change()},c=function(){var i=!0;return t.find(".wcbv-fields > div").removeClass("wcbv-error").find("select").each(function(e,t){0==t.value.length&&(jQuery(t).parent("div").addClass("wcbv-error"),i=!1)}),i},r=function(){var c=[];return t.find(".wcbv-variations .wcbv-row").each(function(e,t){var i=jQuery(t);if(i.data("variation")&&0<i.find(".wcbv-quantity input").val().length){var a=i.find(".wcbv-quantity input").val(),n=i.data("variation");!isNaN(a)&&0<a&&(n.wcbv_quantity=parseInt(i.find(".wcbv-quantity input").val()),c.push(n))}}),c},o=function(){var c=0,e=Number(t.find(".wcbv-total-price .wcbv-price-value").text()),r=0;"undefined"!=typeof fancyProductDesigner&&(r=parseFloat(fancyProductDesigner.calculatePrice())),
//loop through all rows to calculate variation price * quantity
t.find(".wcbv-variations .wcbv-row").each(function(e,t){var i=jQuery(t);if(i.data("variation")&&0<i.find(".wcbv-quantity input").val().length){var a=i.find(".wcbv-quantity input").val(),n=i.data("variation");!isNaN(a)&&0<a&&n.price&&(c+=(n.price+r)*a)}}),t.find(".wcbv-total-price .wcbv-price-value").text(l(c)).parents(".wcbv-total-price").toggle(0<c),c!==e&&t.trigger("priceChange",[c])},l=function(e){var t=wcbvOptions.priceThousandSep,i=wcbvOptions.priceDecimalSep,a=e.toString().split("."),n=a[0],c=a[1],r="";if(void 0!==n){for(var v=n.length-1;0<=v;v--)r+=n.charAt(v);(r=r.replace(/(\d{3})/g,"$1"+t)).slice(-t.length)==t&&(r=r.slice(0,-t.length)),n="";for(var v=r.length-1;0<=v;v--)n+=r.charAt(v);void 0!==c&&0<c.length&&(
//if only one decimal digit add zero at end
1==c.length?c+="0":2<c.length&&(c=c.substring(0,2)),n+=i+c)}return n};
//set first option text to attribute name
wcbvOptions.replaceChooseOption&&v.each(function(e,t){jQuery(t).children("option:first").text(wcbvOptions.attributeNames[e])});
//copy clear variations element
var d=i.find(".reset_variations").clone().removeClass("reset_variations").addClass("wcbv-reset-variations");if(t.find(".wcbv-actions").append(d),t.on("change",".wcbv-fields select",function(){var n=(s=jQuery(this)).parents(".wcbv-row:first"),e;s.parent("div").removeClass("wcbv-error"),//remove column error
a.find("select").each(function(e,t){
//set wc selects to the same value as for the wcbv selects in a row
jQuery(t).val(n.find('select[data-attribute="'+t.name+'"]').val()).change()}).filter('select[name="'+s.data("attribute")+'"]').val(s.val()).change(),a.find('select:not([name="'+s.data("attribute")+'"])').each(function(e,t){var i=n.find('[data-attribute="'+this.name+'"]'),a=i.val();i.html(jQuery(t).html()).val(a)})}),t.on("click","#wcbv-add-row",function(){e(wcbvOptions.selectedAttributes)}).on("change keyup",".wcbv-quantity input",function(){o()}).on("click",".wcbv-remove-row",function(){n=!1,jQuery(this).parents(".wcbv-row").remove(),
//set wc selects options to wcbv select options
t.find(".wcbv-row:first select").each(function(e,t){var i=jQuery(t);a.find('select[name="'+i.data("attribute")+'"]').val(i.val())}).last().change(),//change one to reset wc selects
n=!0}).on("click",".wcbv-reset-variations",function(e){e.preventDefault(),t.find(".wcbv-variations select").val("").change(),t.find(".wcbv-quantity input").val("1"),i.find(".reset_variations").click()}),i.on("show_variation",function(e,t,i){if(s&&void 0!==t.display_price){var a={variation_id:t.variation_id,price:t.display_price},n={};v.each(function(e,t){n[t.name]=t.value}),a.attributes=n,t.price_html&&0<t.price_html.length?//different prices in the variations
s.parents(".wcbv-row:first").data("variation",a).addClass("wcbv-show-price").children(".wcbv-price").html(jQuery(t.price_html).find(".amount:last").text()):void 0!==t.display_price&&//same price in the variations
s.parents(".wcbv-row:first").data("variation",a),o()}}).on("hide_variation",function(e){s&&n&&s.parents(".wcbv-row:first").data("variation","").removeClass("wcbv-show-price"),o()}),
//fill custom form with values and then submit
i.on("click",":submit",function(e){e.preventDefault(),
//check all wcbv selects having a value and add-to-cart button is not disabled
c()&&!i.find(".single_add_to_cart_button").hasClass("disabled")&&(i.find('[name="_wcbv_variations"]').val(JSON.stringify(r())),"undefined"!=typeof fancyProductDesigner&&i.find('[name="_wcbv_fpd_price"]').val(parseFloat(fancyProductDesigner.calculatePrice())),i.submit())}),"undefined"!=typeof fancyProductDesigner&&jQuery(".fpd-container").on("priceChange",function(){o()}),void 0===wcbvOptions.fixedAmount||0===wcbvOptions.fixedAmount)e(wcbvOptions.selectedAttributes);else for(var u=0;u<wcbvOptions.fixedAmount;++u)e(wcbvOptions.selectedAttributes)});